time.variable = "ano",
treatment.identifier = "AVENIDA DOS BANDEIRANTES",
controls.identifier = avenidas[!avenidas == "AVENIDA DOS BANDEIRANTES"],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
View(texas)
View(df.prep)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = "AVENIDA DOS BANDEIRANTES",
controls.identifier = avenidas[!avenidas == "AVENIDA DOS BANDEIRANTES"],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = "AVENIDA DOS BANDEIRANTES",
controls.identifier = avenidas[!avenidas == "AVENIDA DOS BANDEIRANTES"],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = "AVENIDA DOS BANDEIRANTES",
controls.identifier = avenidas[!avenidas == "AVENIDA DOS BANDEIRANTES"],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = avenidas[!id == 9],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
as.data.frame()
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = avenidas[!id == 9],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = id[!id == 9],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2003
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = id[!id == 9],
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = id,
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
1:8
10:31
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "id",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
synth_out <- synth(data.prep.obj = dataprep_out)
path.plot(synth_out, dataprep_out)
df <- df.original %>%
as_tibble() %>%
select(data = "Data do Acidente", rua = "Logradouro", id = ID,
motocicletas = "Veículos Envolvidos - Motocicleta",
feridos_graves = "Pessoas Envolvidas - Grave",
feridos_leves = "Pessoas Envolvidas - Leve") %>%
filter(rua %in% avenidas, motocicletas > 0,
(feridos_graves > 0 | feridos_leves > 0)) %>%
mutate(ano = year(data),
mes = month(data),
acidente = 1) %>%
group_by(ano, rua) %>%
summarize(acidentes = sum(acidente)) %>%
mutate(data = as_date(year_month_day(ano, mes, 1))) %>%
arrange(rua, desc(data)) %>%
group_by(rua) %>%
mutate(acidentes_mm = rollmean(acidentes, k = 10, fill = NA)) %>%
ungroup()
df <- df.original %>%
as_tibble() %>%
select(data = "Data do Acidente", rua = "Logradouro", id = ID,
motocicletas = "Veículos Envolvidos - Motocicleta",
feridos_graves = "Pessoas Envolvidas - Grave",
feridos_leves = "Pessoas Envolvidas - Leve") %>%
filter(rua %in% avenidas, motocicletas > 0,
(feridos_graves > 0 | feridos_leves > 0)) %>%
mutate(ano = year(data),
mes = month(data),
acidente = 1) %>%
group_by(ano, mes, rua) %>%
summarize(acidentes = sum(acidente)) %>%
mutate(data = as_date(year_month_day(ano, mes, 1))) %>%
arrange(rua, desc(data)) %>%
group_by(rua) %>%
mutate(acidentes_mm = rollmean(acidentes, k = 10, fill = NA)) %>%
ungroup()
df %>%
filter(rua == "AVENIDA DOS BANDEIRANTES") %>%
ggplot(aes(x = data)) +
geom_line(aes(y = acidentes_mm), linetype = "dashed") +
geom_line(aes(y = acidentes))
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
as.data.frame()
?dataprep
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "data",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
View(df.prep)
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes)
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes) %>%
as.data.frame()
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
View(df.prep)
df.prep %>%
group_by(rua) %>%
summarize(a = count(id))
df.prep %>%
group_by(rua) %>%
summarize(a = n(id))
df.prep %>%
group_by(rua) %>%
summarize(a = sum(id))
df.prep %>%
group_by(rua) %>%
summarize(a = n(id))
df.prep %>%
group_by(rua) %>%
summarize(a = n())
df.prep %>%
group_by(rua) %>%
summarize(a = n()) %>%
View()
df.prep %>%
group_by(id) %>%
summarize(a = n()) %>%
View()
df.prep %>%
group_by(id) %>%
summarize(n = n()) %>%
View()
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes) %>%
as.data.frame() %>%
semi_join(. %>%
group_by(id) %>%
summarize(n = n()))
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes) %>%
as.data.frame()
df.prep <- semi_join(df.prep %>%
group_by(id) %>%
summarize(n = n()))
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes) %>%
as.data.frame()
df.prep <- df.prep %>%
semi_join(df.prep %>%
group_by(id) %>%
summarize(n = n()))
View(df.prep)
View(df.prep)
df.prep %>%
group_by(id) %>%
summarize(n = n())
df.prep <- df.prep %>%
semi_join(df.prep %>%
group_by(id) %>%
summarize(n = n()) %>%
filter(n == 56))
df.prep %>%
group_by(id) %>%
summarize(n = n())
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:8, 10:31),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
View(df.prep)
df.prep %>%
distinct(id)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(1:4, 9, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 9, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = 2019:2022,
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = 2019:2022,
time.plot = 2019:2023
)
?seq
seq(2019, 2022, by = 1)
seq(2019, 2022, by = 1/12)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = seq(2019 + 1/12, 2022 + 8/12, by = 1/12),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 1/12, 2022 + 8/12, by = 1/12),
time.plot = seq(2019 + 1/12, 2022 + 9/12, by = 1/12)
)
seq(2019, 2022, by = 1/12) %>% round()
seq(2019, 2022, by = 1/12) %>% round(1)
seq(2019, 2022, by = 1/12) %>% round(3)
df.prep <- df %>%
group_by(rua) %>%
summarize(id = 1) %>%
mutate(id = cumsum(id)) %>%
right_join(df) %>%
mutate(mes = mes/12,
ano = ano + mes) %>%
as.data.frame()
df.prep <- df.prep %>%
semi_join(df.prep %>%
group_by(id) %>%
summarize(n = n()) %>%
filter(n == 56)) %>%
mutate(ano = ano %>% round(3))
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes"),
time.predictors.prior = seq(2019 + 1/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 1/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 1/12, 2022 + 9/12, by = 1/12) %>% round(3)
)
synth_out <- synth(data.prep.obj = dataprep_out)
path.plot(synth_out, dataprep_out)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
time.predictors.prior = seq(2019 + 1/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes_mm",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 1/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 1/12, 2022 + 9/12, by = 1/12) %>% round(3)
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
time.predictors.prior = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes_mm",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 11/12, 2022 + 9/12, by = 1/12) %>% round(3)
)
synth_out <- synth(data.prep.obj = dataprep_out)
path.plot(synth_out, dataprep_out)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
time.predictors.prior = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes_mm",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 11/12, 2023 + 9/12, by = 1/12) %>% round(3)
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
time.predictors.prior = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes_mm",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 11/12, 2023 + 5/12, by = 1/12) %>% round(3)
)
dataprep_out <- dataprep(
foo = df.prep,
predictors = c("acidentes_mm"),
time.predictors.prior = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
predictors.op = "mean",
dependent = "acidentes_mm",
unit.variable = "id",
unit.names.variable = "rua",
time.variable = "ano",
treatment.identifier = 9,
controls.identifier = c(2:4, 8, 12, 14, 15, 18, 20, 21, 24, 25, 26, 28, 29 ,30),
time.optimize.ssr = seq(2019 + 11/12, 2022 + 8/12, by = 1/12) %>% round(3),
time.plot = seq(2019 + 11/12, 2023 + 1/12, by = 1/12) %>% round(3)
)
synth_out <- synth(data.prep.obj = dataprep_out)
path.plot(synth_out, dataprep_out)
